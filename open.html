<!doctype html>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ouverture…</title>
<script>
(function () {
  function qsmulti(name){
    const sp = new URLSearchParams(location.search);
    const vals = [];
    for (const [k,v] of sp.entries()) if (k === name) vals.push(decodeURIComponent(v));
    return vals;
  }
  function qs(name){
    const sp = new URLSearchParams(location.search);
    const v = sp.get(name);
    return v ? decodeURIComponent(v) : null;
  }

  const ua = navigator.userAgent || '';
  const isAndroid = /Android/i.test(ua);
  const isIOS = /iPhone|iPad|iPod/i.test(ua);

  const apps = qsmulti('app');           // 0..n candidats
  const web  = qs('web') || 'https://www.google.com';
  const pkg  = qs('pkg');

  // Construire un intent Android si possible
  function buildAndroidIntent(fallback){
    if (!pkg) return null;
    try {
      const u = new URL(fallback);
      const path = u.host + u.pathname + (u.search || '');
      const encFallback = encodeURIComponent(fallback);
      return `intent://${path}#Intent;scheme=https;package=${pkg};S.browser_fallback_url=${encFallback};end`;
    } catch { return null; }
  }

  const intentUrl = isAndroid ? buildAndroidIntent(web) : null;

  async function tryCandidates() {
    // Ordre de priorité :
    // 1) Android: intent direct (suffit souvent à ouvrir l’app)
    // 2) iOS/Android: essayer les schemes passés en ?app=... (un par un)
    // 3) Fallback web
    if (isAndroid && intentUrl) {
      window.location.href = intentUrl;
      // Attends un peu, si on reste ici, on enchaîne sur les apps éventuelles
      await new Promise(r => setTimeout(r, 600));
    }

    for (const a of apps) {
      const start = Date.now();
      try { window.location.href = a; } catch {}
      await new Promise(r => setTimeout(r, 600));
      // Si l’utilisateur n’a pas quitté la page (pas d’app), on continue
      if (Date.now() - start < 1500) continue;
      else return; // on suppose que ça a bougé
    }

    // Fallback final
    window.location.replace(web);
  }

  if (document.readyState === 'complete' || document.readyState === 'interactive') {
    tryCandidates();
  } else {
    document.addEventListener('DOMContentLoaded', tryCandidates, { once: true });
  }

  // Si l’utilisateur revient (app non installée / annulation), pousser vers web
  document.addEventListener('visibilitychange', () => {
    if (!document.hidden) setTimeout(() => location.replace(web), 600);
  });
})();
</script>
<body style="margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,sans-serif;background:#0b0c10;color:#e5e7eb;display:flex;min-height:100vh;align-items:center;justify-content:center">
  <div style="background:#111827;padding:24px;border-radius:16px;max-width:560px">
    <div style="display:flex;align-items:center;gap:10px">
      <div style="width:24px;height:24px;border:3px solid rgba(255,255,255,.25);border-top-color:#fff;border-radius:50%;animation:spin 1s linear infinite"></div>
      <h1 style="margin:0;font-size:18px">On tente d’ouvrir l’application…</h1>
    </div>
    <p style="opacity:.8">Si rien ne se passe, tu seras redirigé vers la version web.</p>
  </div>
  <style>@keyframes spin{to{transform:rotate(360deg)}}</style>
</body>